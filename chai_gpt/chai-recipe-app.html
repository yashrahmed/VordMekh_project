<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chai Recipe Assistant</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #8B4513;
            text-align: center;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        select, input, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        select:focus, input:focus, textarea:focus {
            border-color: #8B4513;
            outline: none;
        }
        .inventory-section {
            margin-top: 20px;
            border: 2px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            background-color: #fafafa;
        }
        .inventory-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px;
            background: white;
            border-radius: 3px;
            border: 1px solid #eee;
        }
        .inventory-item input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
        }
        .inventory-item.confirmed {
            background-color: #e8f5e8;
            border-color: #4CAF50;
        }
        .instructions-section {
            margin-top: 20px;
        }
        textarea {
            min-height: 200px;
            resize: vertical;
            background-color: #f9f9f9;
        }
        .empty-state {
            color: #666;
            font-style: italic;
            text-align: center;
            padding: 20px;
        }
        .select-all-btn {
            background-color: #8B4513;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 15px;
            width: auto;
        }
        .select-all-btn:hover:not(:disabled) {
            background-color: #6B3410;
        }
        .select-all-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ«– Chai Recipe Assistant</h1>
        
        <form id="chaiForm">
            <div class="form-group">
                <label for="chaiType">Chai Type:</label>
                <select id="chaiType" name="chaiType">
                    <option value="">Select a chai type...</option>
                    <option value="masala_chai">Masala Chai</option>
                    <option value="adrak_chai">Adrak Chai</option>
                    <option value="sulaimani_chai">Sulaimani Chai</option>
                    <option value="kashmiri_noon_chai">Kashmiri Noon Chai</option>
                    <option value="kahwah">Kahwah</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="servings">Amount of Servings:</label>
                <input type="number" id="servings" name="servings" min="1" max="6" step="0.5" placeholder="Enter servings (1-6)">
            </div>
            
            <div class="form-group">
                <label for="heatingEquipment">Heating Equipment & Power Source:</label>
                <select id="heatingEquipment" name="heatingEquipment">
                    <option value="">Select heating equipment...</option>
                    <option value="gas_stove">Gas Stove (Natural Gas/LPG)</option>
                    <option value="electric_coil_stove">Electric Coil Stove (Power outlet)</option>
                    <option value="portable_butane_stove">Portable Butane Stove (Butane Canister)</option>
                    <option value="induction_cooktop">Induction Cooktop (Power outlet)</option>
                    <option value="campfire">Campfire (Wood/Combustible Materials)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Inventory:</label>
                <button type="button" id="selectAllBtn" class="select-all-btn" onclick="toggleSelectAll()" disabled>
                    Select All
                </button>
                <div id="inventory" class="inventory-section">
                    <div class="empty-state">Select chai type and servings to populate inventory</div>
                </div>
            </div>
            
            <div class="form-group instructions-section">
                <label for="instructions">Instructions:</label>
                <textarea id="instructions" name="instructions" readonly placeholder="Instructions will appear here once all inventory items are confirmed"></textarea>
            </div>
        </form>
    </div>

    <script>
        const recipes = {
            masala_chai: {
                ingr: [
                    ["Water", 0.75, "cup"],
                    ["Whole Milk", 0.5, "cup"],
                    ["Loose Black Tea", 1, "tsp"],
                    ["Grated Fresh Ginger", 0.5, "tsp"],
                    ["Ground Cinnamon", 0.25, "tsp"],
                    ["Green Cardamom Pods", 3, "pods"],
                    ["Whole Cloves", 2, "cloves"],
                    ["Black Peppercorns", 2, "peppercorns"],
                    ["Fennel Seeds", 0.25, "tsp"],
                    ["Jaggery or Sugar", 1, "tsp"]
                ],
                tools: [
                    ["Medium Pot", 1, null],
                    ["Mortar and Pestle", 1, null],
                    ["Strainer", 1, null]
                ],
                steps: [
                    "Using a mortar and pestle, lightly crush cardamom, cloves, peppercorns, and fennel seeds.",
                    "Add crushed spices, ginger, and cinnamon to a pot with {water} of Water. Boil, then simmer covered for 5-6 min.",
                    "Add {tea} of loose tea and simmer for another 2-3 min.",
                    "Pour in {milk} of milk and heat until just before boiling.",
                    "Strain into a cup and stir in sweetener."
                ]
            },
            adrak_chai: {
                ingr: [
                    ["Water", 0.75, "cup"],
                    ["Whole Milk", 0.5, "cup"],
                    ["Loose Black Tea", 1.5, "tsp"],
                    ["Grated Fresh Ginger", 3, "tsp"],
                    ["Jaggery or Sugar", 1, "tsp"]
                ],
                tools: [
                    ["Small Saucean", 1, null],
                    ["Mortar and Pestle", 1, null],
                    ["Strainer", 1, null]
                ],
                steps: [
                    "Combine {water} of Water and {ginger} of ginger in a saucepan. Boil and simmer for 3-5 min.",
                    "Add {tea} of tea leaves and simmer for 2-3 min.",
                    "Pour in {milk} of Milk and bring to a final, gentle boil.",
                    "Strain into a cup and sweeten to taste."
                ]
            },
            sulaimani_chai: {
                ingr: [
                    ["Water", 1, "cup"],
                    ["Loose Black Tea", 1, "tsp"],
                    ["Whole Cloves", 2, "cloves"],
                    ["Green Cardamom Pods", 1, "pods"],
                    ["Saffron Threads", 5, "threads"],
                    ["Lemon Juice", 1, "tsp"],
                    ["Fresh Mint Leaves", 3, "leaves"],
                    ["Honey or Jaggery", 1, "tsp"]
                ],
                tools: [
                    ["Small Pot", 1, null],
                    ["Strainer", 1, null]
                ],
                steps: [
                    "Boil {water} of Water with 2 crushed cloves, 1 crushed cardamom, and 5 saffron threads. Simmer 2 min.",
                    "Remove from heat, add {tea} of tea leaves, and steep for 2-3 min. Do not boil tea leaves.",
                    "Strain. Stir in lemon juice, mint, and sweetener."
                ]
            },
            kashmiri_noon_chai: {
                ingr: [
                    ["Water", 1.5, "cup"],
                    ["Ice", 0.5, "cup"],
                    ["Kashmiri Green Tea Leaves", 1, "tsp"],
                    ["Baking Soda", 0.125, "tsp"],
                    ["Whole Milk", 0.75, "cup"],
                    ["Salt", 0.5, "tsp"],
                    ["Green Cardamom Pods", 1, "pods"],
                    ["Crushed Nuts", 0.5, "tbsp"]
                ],
                tools: [
                    ["Medium Pot", 1, null],
                    ["Whisk or Deep Ladle", 1, null],
                    ["Strainer", 1, null]
                ],
                steps: [
                    "Boil {water} Water, {tea} tea, and {bakingsoda} baking soda. Simmer 15-25 min until liquid reduces by half.",
                    "Add {ice} of Ice/Water. Whisk or aerate vigorously until frothy.",
                    "Stir in {milk} milk and 1 crushed cardamom. Gently simmer (do not boil) for 5-10 min until pink.",
                    "Season with salt, strain, and garnish."
                ]
            },
            kahwah: {
                ingr: [
                    ["Water", 1, "cup"],
                    ["Green Tea Leaves", 0.5, "tsp"],
                    ["Green Cardamom Pods", 1, "pods"],
                    ["Ground Cinnamon", 0.125, "tsp"],
                    ["Saffron Threads", 5, "threads"],
                    ["Dried Rose Petals", 0.5, "tsp"],
                    ["Slivered Almonds", 0.5, "tbsp"],
                    ["Honey or Sugar", 1, "tsp"]
                ],
                tools: [
                    ["Pot", 1, null],
                    ["Strainer", 1, null]
                ],
                steps: [
                    "Boil {water} Water with 1 crushed cardamom, {cinnamon} cinnamon, 5 saffron threads, and rose petals. Simmer 5 min.",
                    "Turn off heat. Add {tea} green tea, cover, and steep for 2-3 min.",
                    "Strain into a cup. Sweeten and garnish with almonds."
                ]
            }
        };

        const spicesAndAromatics = [
            "Grated Fresh Ginger", "Ground Cinnamon", "Green Cardamom Pods", 
            "Whole Cloves", "Black Peppercorns", "Fennel Seeds", "Saffron Threads",
            "Fresh Mint Leaves", "Dried Rose Petals", "Slivered Almonds"
        ];

        let currentInventory = [];
        let currentConfirmedItems = new Set();

        document.getElementById('chaiType').addEventListener('change', updateInventory);
        document.getElementById('servings').addEventListener('input', updateInventory);
        document.getElementById('heatingEquipment').addEventListener('change', updateInventory);

        function updateInventory() {
            const chaiType = document.getElementById('chaiType').value;
            const servings = parseFloat(document.getElementById('servings').value);
            const heatingEquipment = document.getElementById('heatingEquipment').value;
            
            if (!heatingEquipment) {
                document.getElementById('inventory').innerHTML = '<div class="empty-state">Select heating equipment first</div>';
                document.getElementById('instructions').value = '';
                updateSelectAllButton();
                return;
            }
            
            if (!chaiType || !servings || servings < 1 || servings > 6) {
                document.getElementById('inventory').innerHTML = '<div class="empty-state">Select chai type and servings to populate inventory</div>';
                document.getElementById('instructions').value = '';
                updateSelectAllButton();
                return;
            }

            const recipe = recipes[chaiType];
            const newInventory = [];
            
            recipe.ingr.forEach(([name, baseQty, unit]) => {
                let scaledQty;
                if (spicesAndAromatics.includes(name)) {
                    scaledQty = baseQty * Math.pow(servings, 0.65);
                } else {
                    scaledQty = baseQty * servings;
                }
                scaledQty = Math.round(scaledQty * 1000) / 1000;
                newInventory.push({name, quantity: scaledQty, unit});
            });

            recipe.tools.forEach(([name, baseQty, unit]) => {
                const scaledQty = baseQty * servings;
                newInventory.push({name, quantity: scaledQty, unit});
            });
            
            // Add heating equipment and power source
            const heatingEquipmentMap = {
                gas_stove: { equipment: "Gas Stove", power: "Natural Gas/LPG" },
                electric_coil_stove: { equipment: "Electric Coil Stove", power: "Power outlet" },
                portable_butane_stove: { equipment: "Portable Butane Stove", power: "Butane Canister" },
                induction_cooktop: { equipment: "Induction Cooktop", power: "Power outlet" },
                campfire: { equipment: "Campfire", power: "Wood/Combustible Materials" }
            };
            
            const selectedHeating = heatingEquipmentMap[heatingEquipment];
            newInventory.push({name: selectedHeating.equipment, quantity: 1, unit: null});
            newInventory.push({name: selectedHeating.power, quantity: 1, unit: null});

            currentInventory = newInventory;
            updateInventoryDisplay(newInventory);
            clearInstructions();
        }

        function updateInventoryDisplay(newInventory) {
            const inventoryDiv = document.getElementById('inventory');
            inventoryDiv.innerHTML = '';

            // First pass: update confirmations based on quantity changes
            newInventory.forEach((item) => {
                const existingItem = currentInventory.find(i => i.name === item.name);
                
                if (existingItem && currentConfirmedItems.has(item.name)) {
                    if (item.quantity > existingItem.quantity) {
                        currentConfirmedItems.delete(item.name);
                    }
                }
            });

            // Second pass: render the items
            newInventory.forEach((item, index) => {
                const shouldKeepConfirmation = currentConfirmedItems.has(item.name);

                const itemDiv = document.createElement('div');
                itemDiv.className = `inventory-item ${shouldKeepConfirmation ? 'confirmed' : ''}`;
                
                const unitText = item.unit ? ` ${item.unit}` : '';
                const quantityText = item.quantity % 1 === 0 ? item.quantity.toString() : item.quantity.toFixed(3).replace(/\.?0+$/, '');
                
                itemDiv.innerHTML = `
                    <input type="checkbox" id="item_${index}" ${shouldKeepConfirmation ? 'checked' : ''} 
                           onchange="toggleConfirmation('${item.name}', this)">
                    <label for="item_${index}">${item.name}: ${quantityText}${unitText}</label>
                `;
                
                inventoryDiv.appendChild(itemDiv);
            });
            
            updateSelectAllButton();
        }

        function toggleConfirmation(itemName, checkbox) {
            if (checkbox.checked) {
                currentConfirmedItems.add(itemName);
                checkbox.parentElement.classList.add('confirmed');
            } else {
                currentConfirmedItems.delete(itemName);
                checkbox.parentElement.classList.remove('confirmed');
                clearInstructions();
            }
            
            updateSelectAllButton();
            checkAllConfirmed();
        }

        function checkAllConfirmed() {
            const heatingEquipment = document.getElementById('heatingEquipment').value;
            if (!heatingEquipment) {
                return;
            }
            
            if (currentInventory.length > 0 && currentConfirmedItems.size === currentInventory.length) {
                generateInstructions();
            }
        }

        function generateInstructions() {
            const chaiType = document.getElementById('chaiType').value;
            const servings = parseFloat(document.getElementById('servings').value);
            const heatingEquipment = document.getElementById('heatingEquipment').value;
            const recipe = recipes[chaiType];
            
            if (!heatingEquipment) {
                return;
            }
            
            const heatingEquipmentMap = {
                gas_stove: { equipment: "Gas Stove", power: "Natural Gas/LPG" },
                electric_coil_stove: { equipment: "Electric Coil Stove", power: "Power outlet" },
                portable_butane_stove: { equipment: "Portable Butane Stove", power: "Butane Canister" },
                induction_cooktop: { equipment: "Induction Cooktop", power: "Power outlet" },
                campfire: { equipment: "Campfire", power: "Wood/Combustible Materials" }
            };
            
            const selectedHeating = heatingEquipmentMap[heatingEquipment];
            let instructions = `Recipe for ${servings} serving${servings !== 1 ? 's' : ''} of ${chaiType.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())}:\n\n`;
            instructions += `Heating Equipment: ${selectedHeating.equipment} (${selectedHeating.power})\n\n`;
            
            instructions += "Adjusted Ingredients:\n";
            recipe.ingr.forEach(([name, baseQty, unit]) => {
                let scaledQty;
                if (spicesAndAromatics.includes(name)) {
                    scaledQty = baseQty * Math.pow(servings, 0.65);
                } else {
                    scaledQty = baseQty * servings;
                }
                scaledQty = Math.round(scaledQty * 1000) / 1000;
                const quantityText = scaledQty % 1 === 0 ? scaledQty.toString() : scaledQty.toFixed(3).replace(/\.?0+$/, '');
                const unitText = unit ? ` ${unit}` : '';
                instructions += `â€¢ ${name}: ${quantityText}${unitText}\n`;
            });
            
            instructions += "\nPreparation Steps:\n";
            recipe.steps.forEach((step, index) => {
                let processedStep = step;
                const waterItem = currentInventory.find(i => i.name === "Water");
                const milkItem = currentInventory.find(i => i.name === "Whole Milk");
                const teaItem = currentInventory.find(i => i.name.includes("Tea"));
                const gingerItem = currentInventory.find(i => i.name === "Grated Fresh Ginger");
                const cinnamonItem = currentInventory.find(i => i.name === "Ground Cinnamon");
                const bakingSodaItem = currentInventory.find(i => i.name === "Baking Soda");
                const iceItem = currentInventory.find(i => i.name === "Ice");

                if (waterItem) {
                    const qty = waterItem.quantity % 1 === 0 ? waterItem.quantity : waterItem.quantity.toFixed(3).replace(/\.?0+$/, '');
                    processedStep = processedStep.replace('{water}', `${qty} ${waterItem.unit || ''}`);
                }
                if (milkItem) {
                    const qty = milkItem.quantity % 1 === 0 ? milkItem.quantity : milkItem.quantity.toFixed(3).replace(/\.?0+$/, '');
                    processedStep = processedStep.replace('{milk}', `${qty} ${milkItem.unit || ''}`);
                }
                if (teaItem) {
                    const qty = teaItem.quantity % 1 === 0 ? teaItem.quantity : teaItem.quantity.toFixed(3).replace(/\.?0+$/, '');
                    processedStep = processedStep.replace('{tea}', `${qty} ${teaItem.unit || ''}`);
                }
                if (gingerItem) {
                    const qty = gingerItem.quantity % 1 === 0 ? gingerItem.quantity : gingerItem.quantity.toFixed(3).replace(/\.?0+$/, '');
                    processedStep = processedStep.replace('{ginger}', `${qty} ${gingerItem.unit || ''}`);
                }
                if (cinnamonItem) {
                    const qty = cinnamonItem.quantity % 1 === 0 ? cinnamonItem.quantity : cinnamonItem.quantity.toFixed(3).replace(/\.?0+$/, '');
                    processedStep = processedStep.replace('{cinnamon}', `${qty} ${cinnamonItem.unit || ''}`);
                }
                if (bakingSodaItem) {
                    const qty = bakingSodaItem.quantity % 1 === 0 ? bakingSodaItem.quantity : bakingSodaItem.quantity.toFixed(3).replace(/\.?0+$/, '');
                    processedStep = processedStep.replace('{bakingsoda}', `${qty} ${bakingSodaItem.unit || ''}`);
                }
                if (iceItem) {
                    const qty = iceItem.quantity % 1 === 0 ? iceItem.quantity : iceItem.quantity.toFixed(3).replace(/\.?0+$/, '');
                    processedStep = processedStep.replace('{ice}', `${qty} ${iceItem.unit || ''}`);
                }
                
                instructions += `${index + 1}. ${processedStep}\n`;
            });
            
            document.getElementById('instructions').value = instructions;
        }

        function clearInstructions() {
            document.getElementById('instructions').value = '';
        }

        function updateSelectAllButton() {
            const selectAllBtn = document.getElementById('selectAllBtn');
            
            if (currentInventory.length === 0) {
                selectAllBtn.disabled = true;
                selectAllBtn.textContent = 'Select All';
                return;
            }
            
            selectAllBtn.disabled = false;
            
            if (currentConfirmedItems.size === currentInventory.length) {
                selectAllBtn.textContent = 'Deselect All';
            } else {
                selectAllBtn.textContent = 'Select All';
            }
        }

        function toggleSelectAll() {
            const selectAllBtn = document.getElementById('selectAllBtn');
            const shouldSelectAll = currentConfirmedItems.size < currentInventory.length;
            
            currentInventory.forEach((item, index) => {
                const checkbox = document.getElementById(`item_${index}`);
                const itemDiv = checkbox.parentElement;
                
                if (shouldSelectAll) {
                    if (!currentConfirmedItems.has(item.name)) {
                        checkbox.checked = true;
                        currentConfirmedItems.add(item.name);
                        itemDiv.classList.add('confirmed');
                    }
                } else {
                    checkbox.checked = false;
                    currentConfirmedItems.delete(item.name);
                    itemDiv.classList.remove('confirmed');
                }
            });
            
            if (!shouldSelectAll) {
                clearInstructions();
            }
            
            updateSelectAllButton();
            checkAllConfirmed();
        }
    </script>
</body>
</html>